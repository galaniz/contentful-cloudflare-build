'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var F = require('react');
var f36Core = require('@contentful/f36-core');
var f36Popover = require('@contentful/f36-popover');
var emotion = require('emotion');
var T = require('@contentful/f36-tokens');
var f36Typography = require('@contentful/f36-typography');
var f36Icons = require('@contentful/f36-icons');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var F__default = /*#__PURE__*/_interopDefaultLegacy(F);
var T__default = /*#__PURE__*/_interopDefaultLegacy(T);

var Fe=Object.defineProperty,We=Object.defineProperties;var Be=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var ue=(e,t,o)=>t in e?Fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,u=(e,t)=>{for(var o in t||(t={}))me.call(t,o)&&ue(e,o,t[o]);if(W)for(var o of W(t))ae.call(t,o)&&ue(e,o,t[o]);return e},C=(e,t)=>We(e,Be(t));var b=(e,t)=>{var o={};for(var n in e)me.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(e!=null&&W)for(var n of W(e))t.indexOf(n)<0&&ae.call(e,n)&&(o[n]=e[n]);return o};var ce={vertical:{prev:"ArrowUp",next:"ArrowDown"},horizontal:{prev:"ArrowLeft",next:"ArrowRight"}},pe=({itemsContainerRef:e,itemsSelector:t,keyType:o="vertical"})=>{let[n,s]=F.useState(0),a=F.useCallback(i=>{let l=e.current;if(!l)return;let M=l.querySelectorAll(t);if(M.length===0)return;let c=M.length-1,S=()=>s(0),y=()=>s(c),f=()=>{n===c?S():s(n+1);},P=()=>{n===0?y():s(n-1);},h={[ce[o].next]:f,[ce[o].prev]:P}[i.key];h&&(i.preventDefault(),h());},[n,t,e,o]);return {focusedIndex:n,handleArrowsKeyDown:a,setFocusedIndex:s}};var fe=F__default["default"].createContext(void 0),O=()=>{let e=F__default["default"].useContext(fe);if(e===void 0)throw new Error("useMenuContext must be used within a MenuContextProvider");return e},de=fe.Provider;var z='[role="menuitem"]:not(:disabled)';function B(e){let oe=e,{closeOnSelect:t=!0,closeOnBlur:o=!0,closeOnEsc:n=!0,children:s,onOpen:a}=oe,i=b(oe,["closeOnSelect","closeOnBlur","closeOnEsc","children","onOpen"]),{isOpen:l,handleOpen:M,handleClose:c,isControlled:S}=f36Core.useControllableState({isOpen:e.isOpen,defaultIsOpen:e.defaultIsOpen,onOpen:a,onClose:e.onClose}),y=F.useRef(null),f=F.useRef(null),P=f36Core.useId(null,"menu"),{focusedIndex:d,handleArrowsKeyDown:h,setFocusedIndex:m}=pe({itemsContainerRef:f,itemsSelector:z});F.useEffect(()=>{if(l&&f.current){let r=f.current.querySelectorAll(z);r.length>0&&d<r.length&&setTimeout(()=>{r[d].focus({preventScroll:!1});},0);}},[l,d]);let R=F.useCallback(r=>{let g=[...f.current.querySelectorAll(z)].findIndex(x=>r===x);g!==-1&&m(g);},[m]),p=F.useCallback(()=>{var r;c(),(r=y.current)==null||r.focus({preventScroll:!0});},[c]),I=F.useCallback(r=>{if(r.key==="Tab"){r.preventDefault(),p();return}if(r.stopPropagation(),r.key==="ArrowLeft"){r.preventDefault(),p();return}h(r);},[p,h]),K=F.useRef(!1),De=F.useMemo(()=>({isOpen:l,menuId:P,focusMenuItem:R,getTriggerProps:(r={},w=null)=>({onMouseDown:g=>{var x;K.current=!0,(x=r.onMouseDown)==null||x.call(r,g);},onMouseUp:g=>{var x;K.current=!1,(x=r.onMouseUp)==null||x.call(r,g);},onClick:g=>{var E;S&&!a||(l?c():M()),(E=r.onClick)==null||E.call(r,g);},ref:f36Core.mergeRefs(y,w)}),getMenuListProps:(r={},w=null)=>({ref:f36Core.mergeRefs(f,w),onKeyDown:g=>{var x;I(g),(x=r.onKeyDown)==null||x.call(r,g);},onBlur:g=>{var ne,re,se,ie;if((ne=r.onBlur)==null||ne.call(r,g),!o)return;let x=document.activeElement,E=g.relatedTarget||x,He=f.current===E||((re=f.current)==null?void 0:re.contains(E)),Ne=y.current===E||((se=y.current)==null?void 0:se.contains(E))||K.current,Ae=((ie=E==null?void 0:E.parentElement)==null?void 0:ie.dataset.parentMenu)===P;if(He||Ne||Ae){g.stopPropagation();return}c();}}),getMenuItemProps:(r={})=>({onClick:w=>{var x;(x=r.onClick)==null||x.call(r,w);let g=Boolean(w.target.getAttribute("aria-haspopup"));t&&!g&&p();}}),propsToPropagateToSubmenus:{closeOnSelect:t,closeOnBlur:o,closeOnEsc:n}}),[P,l,I,t,c,M,R,o,n,p,S,a]);return F__default["default"].createElement(de,{value:De},F__default["default"].createElement(f36Popover.Popover,C(u({},i),{isOpen:l,onClose:c,id:P,closeOnEsc:n,autoFocus:!1,closeOnBlur:!1}),s))}var Pe=F__default["default"].createContext(void 0),U=()=>F__default["default"].useContext(Pe),xe=Pe.Provider;var be=()=>emotion.css({position:"sticky",top:0,left:0,backgroundColor:T__default["default"].colorWhite,borderBottom:`1px solid ${T__default["default"].gray300}`,marginBottom:T__default["default"].spacing2Xs,padding:`${T__default["default"].spacing2Xs} 0`,zIndex:1001}),Te=()=>emotion.css({position:"sticky",bottom:0,left:0,backgroundColor:T__default["default"].colorWhite,borderTop:`1px solid ${T__default["default"].gray300}`,marginTop:T__default["default"].spacing2Xs,padding:`${T__default["default"].spacing2Xs} 0`,zIndex:1001}),he=e=>({container:emotion.css({borderRadius:"8px",overflowY:"auto",position:"relative",padding:0,paddingTop:e.hasStickyHeader?0:T__default["default"].spacing2Xs,paddingBottom:e.hasStickyFooter?0:T__default["default"].spacing2Xs})});var k=e=>{let i=e,{children:t,testId:o="cf-ui-menu-list-header",className:n}=i,s=b(i,["children","testId","className"]),a=be();return F__default["default"].createElement("div",u({"data-test-id":o,className:emotion.cx(a,n)},s),t)};k.displayName="MenuListHeader";var D=e=>{let i=e,{children:t,testId:o="cf-ui-menu-list-footer",className:n}=i,s=b(i,["children","testId","className"]),a=Te();return F__default["default"].createElement("div",u({"data-test-id":o,className:emotion.cx(a,n)},s),t)};D.displayName="MenuListFooter";function _e(e){var t;return Boolean((t=e==null?void 0:e.type)==null?void 0:t.displayName)}var et=(e,t)=>{let P=e,{children:o,testId:n="cf-ui-menu-list",className:s}=P,a=b(P,["children","testId","className"]),{getMenuListProps:i}=O(),l=U(),M=null,c=null,S=[];F__default["default"].Children.forEach(o,d=>{let h=!0;_e(d)&&(d.type.displayName===k.displayName?(M=d,h=!1):d.type.displayName===D.displayName&&(c=d,h=!1)),h&&S.push(d);});let y=he({hasStickyHeader:Boolean(M),hasStickyFooter:Boolean(c)}),f=l?l.getSubmenuListProps(a):a;return F__default["default"].createElement(f36Popover.Popover.Content,C(u(u({role:"menu"},f),i(f,t)),{className:emotion.cx(y.container,s),testId:n}),M,S,c)},q=F__default["default"].forwardRef(et);var ot={backgroundColor:T__default["default"].gray200,fontWeight:T__default["default"].fontWeightMedium,"&:hover":{backgroundColor:T__default["default"].gray200}},Se={opacity:.5,cursor:"auto","&:hover":{backgroundColor:"unset"}},Ce=({isActive:e,isDisabled:t})=>({root:emotion.css([{display:"block",width:`calc(100% - 2 * ${T__default["default"].spacing2Xs})`,background:"none",border:0,borderRadius:T__default["default"].borderRadiusMedium,margin:`0 ${T__default["default"].spacing2Xs}`,outline:"none",fontSize:T__default["default"].fontSizeM,lineHeight:T__default["default"].lineHeightM,fontWeight:T__default["default"].fontWeightNormal,position:"relative",textAlign:"left",padding:`6px ${T__default["default"].spacingXs}`,wordBreak:"break-word",whiteSpace:"break-spaces",cursor:"pointer",hyphens:"auto",minWidth:"150px",textDecoration:"none",color:T__default["default"].gray900,'[role="menuitem"] + &':{marginTop:"2px"},"&:hover":{backgroundColor:T__default["default"].gray100},"&:focus":{boxShadow:`inset ${T__default["default"].glowPrimary}`},"&:focus:not(:focus-visible)":{boxShadow:"unset"},"&:focus-visible":{boxShadow:`inset ${T__default["default"].glowPrimary}`},"&:active":{backgroundColor:T__default["default"].gray200},"&:disabled":Se}],e&&ot,t&&Se)});var mt="button";function Ee(e,t){let m=e,{testId:o,className:n,as:s,isActive:a=!1,isDisabled:i=!1,isInitiallyFocused:l}=m,M=b(m,["testId","className","as","isActive","isDisabled","isInitiallyFocused"]),c=f36Core.useId(void 0,"menu-item"),S=o||`cf-ui-${c}`,y=Ce({isActive:a,isDisabled:i}),{getMenuItemProps:f,focusMenuItem:P}=O(),d=F.useRef(null);F.useEffect(()=>{l&&d.current&&P(d.current);},[l,P]);let h=s!=null?s:mt;return F__default["default"].createElement(h,C(u(u({role:"menuitem"},M),f(M)),{className:emotion.cx(y.root,n),"data-test-id":S,ref:f36Core.mergeRefs(d,t),tabIndex:-1}),e.children)}Ee.displayName="MenuItem";var H=F__default["default"].forwardRef(Ee);var N=e=>{let t=F__default["default"].Children.only(e.children),{getTriggerProps:o}=O();return F__default["default"].createElement(f36Popover.Popover.Trigger,null,F__default["default"].cloneElement(t,C(u({},o(t.props,t.ref)),{["aria-haspopup"]:"menu"})))};var Le=()=>emotion.css({border:"none",width:"100%",height:"1px",backgroundColor:T__default["default"].gray200,margin:`${T__default["default"].spacing2Xs} 0`});var V=e=>{let i=e,{children:t,testId:o="cf-ui-menu-divider",className:n}=i,s=b(i,["children","testId","className"]),a=Le();return F__default["default"].createElement("hr",u({"aria-orientation":"horizontal","data-test-id":o,className:emotion.cx(a,n)},s))};var Re=()=>emotion.css({color:T__default["default"].gray500,textAlign:"left",padding:`${T__default["default"].spacingXs} ${T__default["default"].spacingS} ${T__default["default"].spacing2Xs}`,lineHeight:T__default["default"].lineHeightM});var J=e=>{let i=e,{children:t,testId:o="cf-ui-menu-section-title",className:n}=i,s=b(i,["children","testId","className"]),a=Re();return F__default["default"].createElement(f36Typography.Caption,u({"aria-hidden":"true",as:"div",testId:o,className:emotion.cx(a,n),marginBottom:"none"},s),t)};var Tt=[-8,2],Z=e=>{let h=e,{onClose:t,onOpen:o}=h,n=b(h,["onClose","onOpen"]),{isOpen:s,menuId:a,propsToPropagateToSubmenus:i}=O(),l=F.useRef(null),M=F.useRef(null),[c,S]=F.useState(!1),y=F.useCallback(()=>{S(!0),window.clearTimeout(M.current),o==null||o();},[o]),f=F.useCallback(()=>{S(!1),window.clearTimeout(M.current),t==null||t();},[t]),P=F.useCallback(()=>{var m;f(),(m=l.current)==null||m.focus({preventScroll:!0});},[f]);F.useEffect(()=>{s===!1&&S(!1);},[s]);let d=F.useMemo(()=>({isOpen:c,getSubmenuListProps:m=>({"data-parent-menu":a,onMouseOver:R=>{var p;y(),(p=m.onMouseOver)==null||p.call(m,R);},onMouseLeave:R=>{var p;P(),(p=m.onMouseLeave)==null||p.call(m,R);}}),getSubmenuTriggerProps:(m,R)=>({ref:f36Core.mergeRefs(l,R),onKeyDown:p=>{var I;p.key==="ArrowRight"&&(p.preventDefault(),y()),(I=m.onKeyDown)==null||I.call(m,p);},onMouseOver:p=>{var I;y(),(I=m.onMouseOver)==null||I.call(m,p);},onMouseLeave:p=>{var I;M.current=window.setTimeout(P,300),(I=m.onMouseLeave)==null||I.call(m,p);}})}),[c,a,y,P]);return F__default["default"].createElement(xe,{value:d},F__default["default"].createElement(B,C(u(u({},i),n),{isOpen:c,onClose:f,onOpen:y,placement:"right-start",offset:Tt,isAutoalignmentEnabled:!1})))};var ke=()=>({root:({isActive:e})=>emotion.css(u({display:"flex",alignItems:"center",paddingRight:T__default["default"].spacingXs},e?{backgroundColor:T__default["default"].gray100}:{})),content:emotion.css({marginRight:T__default["default"].spacingM}),icon:emotion.css({marginLeft:"auto",fill:"currentColor"})});var Ct=(e,t)=>{let{className:o,children:n}=e,{getSubmenuTriggerProps:s,isOpen:a}=U(),i=ke();return F__default["default"].createElement(N,null,F__default["default"].createElement(H,C(u(u({},e),s(e,t)),{className:emotion.cx(i.root({isActive:a}),o)}),F__default["default"].createElement("span",{className:i.content},n),F__default["default"].createElement(f36Icons.ChevronRightIcon,{className:i.icon})))},te=F__default["default"].forwardRef(Ct);var L=B;L.List=q;L.ListHeader=k;L.ListFooter=D;L.Item=H;L.Trigger=N;L.Divider=V;L.SectionTitle=J;L.Submenu=Z;L.SubmenuTrigger=te;

exports.Menu = L;
exports.MenuDivider = V;
exports.MenuItem = H;
exports.MenuList = q;
exports.MenuSectionTitle = J;
exports.MenuTrigger = N;
exports.Submenu = Z;
exports.SubmenuTrigger = te;
//# sourceMappingURL=index.js.map