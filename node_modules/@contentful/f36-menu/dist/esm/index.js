import F, { useRef, useEffect, useState, useCallback, useMemo } from 'react';
import { useId, mergeRefs, useControllableState } from '@contentful/f36-core';
import { Popover } from '@contentful/f36-popover';
import { cx, css } from 'emotion';
import T from '@contentful/f36-tokens';
import { Caption } from '@contentful/f36-typography';
import { ChevronRightIcon } from '@contentful/f36-icons';

var Fe=Object.defineProperty,We=Object.defineProperties;var Be=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var ue=(e,t,o)=>t in e?Fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,u=(e,t)=>{for(var o in t||(t={}))me.call(t,o)&&ue(e,o,t[o]);if(W)for(var o of W(t))ae.call(t,o)&&ue(e,o,t[o]);return e},C=(e,t)=>We(e,Be(t));var b=(e,t)=>{var o={};for(var n in e)me.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(e!=null&&W)for(var n of W(e))t.indexOf(n)<0&&ae.call(e,n)&&(o[n]=e[n]);return o};var ce={vertical:{prev:"ArrowUp",next:"ArrowDown"},horizontal:{prev:"ArrowLeft",next:"ArrowRight"}},pe=({itemsContainerRef:e,itemsSelector:t,keyType:o="vertical"})=>{let[n,s]=useState(0),a=useCallback(i=>{let l=e.current;if(!l)return;let M=l.querySelectorAll(t);if(M.length===0)return;let c=M.length-1,S=()=>s(0),y=()=>s(c),f=()=>{n===c?S():s(n+1);},P=()=>{n===0?y():s(n-1);},h={[ce[o].next]:f,[ce[o].prev]:P}[i.key];h&&(i.preventDefault(),h());},[n,t,e,o]);return {focusedIndex:n,handleArrowsKeyDown:a,setFocusedIndex:s}};var fe=F.createContext(void 0),O=()=>{let e=F.useContext(fe);if(e===void 0)throw new Error("useMenuContext must be used within a MenuContextProvider");return e},de=fe.Provider;var z='[role="menuitem"]:not(:disabled)';function B(e){let oe=e,{closeOnSelect:t=!0,closeOnBlur:o=!0,closeOnEsc:n=!0,children:s,onOpen:a}=oe,i=b(oe,["closeOnSelect","closeOnBlur","closeOnEsc","children","onOpen"]),{isOpen:l,handleOpen:M,handleClose:c,isControlled:S}=useControllableState({isOpen:e.isOpen,defaultIsOpen:e.defaultIsOpen,onOpen:a,onClose:e.onClose}),y=useRef(null),f=useRef(null),P=useId(null,"menu"),{focusedIndex:d,handleArrowsKeyDown:h,setFocusedIndex:m}=pe({itemsContainerRef:f,itemsSelector:z});useEffect(()=>{if(l&&f.current){let r=f.current.querySelectorAll(z);r.length>0&&d<r.length&&setTimeout(()=>{r[d].focus({preventScroll:!1});},0);}},[l,d]);let R=useCallback(r=>{let g=[...f.current.querySelectorAll(z)].findIndex(x=>r===x);g!==-1&&m(g);},[m]),p=useCallback(()=>{var r;c(),(r=y.current)==null||r.focus({preventScroll:!0});},[c]),I=useCallback(r=>{if(r.key==="Tab"){r.preventDefault(),p();return}if(r.stopPropagation(),r.key==="ArrowLeft"){r.preventDefault(),p();return}h(r);},[p,h]),K=useRef(!1),De=useMemo(()=>({isOpen:l,menuId:P,focusMenuItem:R,getTriggerProps:(r={},w=null)=>({onMouseDown:g=>{var x;K.current=!0,(x=r.onMouseDown)==null||x.call(r,g);},onMouseUp:g=>{var x;K.current=!1,(x=r.onMouseUp)==null||x.call(r,g);},onClick:g=>{var E;S&&!a||(l?c():M()),(E=r.onClick)==null||E.call(r,g);},ref:mergeRefs(y,w)}),getMenuListProps:(r={},w=null)=>({ref:mergeRefs(f,w),onKeyDown:g=>{var x;I(g),(x=r.onKeyDown)==null||x.call(r,g);},onBlur:g=>{var ne,re,se,ie;if((ne=r.onBlur)==null||ne.call(r,g),!o)return;let x=document.activeElement,E=g.relatedTarget||x,He=f.current===E||((re=f.current)==null?void 0:re.contains(E)),Ne=y.current===E||((se=y.current)==null?void 0:se.contains(E))||K.current,Ae=((ie=E==null?void 0:E.parentElement)==null?void 0:ie.dataset.parentMenu)===P;if(He||Ne||Ae){g.stopPropagation();return}c();}}),getMenuItemProps:(r={})=>({onClick:w=>{var x;(x=r.onClick)==null||x.call(r,w);let g=Boolean(w.target.getAttribute("aria-haspopup"));t&&!g&&p();}}),propsToPropagateToSubmenus:{closeOnSelect:t,closeOnBlur:o,closeOnEsc:n}}),[P,l,I,t,c,M,R,o,n,p,S,a]);return F.createElement(de,{value:De},F.createElement(Popover,C(u({},i),{isOpen:l,onClose:c,id:P,closeOnEsc:n,autoFocus:!1,closeOnBlur:!1}),s))}var Pe=F.createContext(void 0),U=()=>F.useContext(Pe),xe=Pe.Provider;var be=()=>css({position:"sticky",top:0,left:0,backgroundColor:T.colorWhite,borderBottom:`1px solid ${T.gray300}`,marginBottom:T.spacing2Xs,padding:`${T.spacing2Xs} 0`,zIndex:1001}),Te=()=>css({position:"sticky",bottom:0,left:0,backgroundColor:T.colorWhite,borderTop:`1px solid ${T.gray300}`,marginTop:T.spacing2Xs,padding:`${T.spacing2Xs} 0`,zIndex:1001}),he=e=>({container:css({borderRadius:"8px",overflowY:"auto",position:"relative",padding:0,paddingTop:e.hasStickyHeader?0:T.spacing2Xs,paddingBottom:e.hasStickyFooter?0:T.spacing2Xs})});var k=e=>{let i=e,{children:t,testId:o="cf-ui-menu-list-header",className:n}=i,s=b(i,["children","testId","className"]),a=be();return F.createElement("div",u({"data-test-id":o,className:cx(a,n)},s),t)};k.displayName="MenuListHeader";var D=e=>{let i=e,{children:t,testId:o="cf-ui-menu-list-footer",className:n}=i,s=b(i,["children","testId","className"]),a=Te();return F.createElement("div",u({"data-test-id":o,className:cx(a,n)},s),t)};D.displayName="MenuListFooter";function _e(e){var t;return Boolean((t=e==null?void 0:e.type)==null?void 0:t.displayName)}var et=(e,t)=>{let P=e,{children:o,testId:n="cf-ui-menu-list",className:s}=P,a=b(P,["children","testId","className"]),{getMenuListProps:i}=O(),l=U(),M=null,c=null,S=[];F.Children.forEach(o,d=>{let h=!0;_e(d)&&(d.type.displayName===k.displayName?(M=d,h=!1):d.type.displayName===D.displayName&&(c=d,h=!1)),h&&S.push(d);});let y=he({hasStickyHeader:Boolean(M),hasStickyFooter:Boolean(c)}),f=l?l.getSubmenuListProps(a):a;return F.createElement(Popover.Content,C(u(u({role:"menu"},f),i(f,t)),{className:cx(y.container,s),testId:n}),M,S,c)},q=F.forwardRef(et);var ot={backgroundColor:T.gray200,fontWeight:T.fontWeightMedium,"&:hover":{backgroundColor:T.gray200}},Se={opacity:.5,cursor:"auto","&:hover":{backgroundColor:"unset"}},Ce=({isActive:e,isDisabled:t})=>({root:css([{display:"block",width:`calc(100% - 2 * ${T.spacing2Xs})`,background:"none",border:0,borderRadius:T.borderRadiusMedium,margin:`0 ${T.spacing2Xs}`,outline:"none",fontSize:T.fontSizeM,lineHeight:T.lineHeightM,fontWeight:T.fontWeightNormal,position:"relative",textAlign:"left",padding:`6px ${T.spacingXs}`,wordBreak:"break-word",whiteSpace:"break-spaces",cursor:"pointer",hyphens:"auto",minWidth:"150px",textDecoration:"none",color:T.gray900,'[role="menuitem"] + &':{marginTop:"2px"},"&:hover":{backgroundColor:T.gray100},"&:focus":{boxShadow:`inset ${T.glowPrimary}`},"&:focus:not(:focus-visible)":{boxShadow:"unset"},"&:focus-visible":{boxShadow:`inset ${T.glowPrimary}`},"&:active":{backgroundColor:T.gray200},"&:disabled":Se}],e&&ot,t&&Se)});var mt="button";function Ee(e,t){let m=e,{testId:o,className:n,as:s,isActive:a=!1,isDisabled:i=!1,isInitiallyFocused:l}=m,M=b(m,["testId","className","as","isActive","isDisabled","isInitiallyFocused"]),c=useId(void 0,"menu-item"),S=o||`cf-ui-${c}`,y=Ce({isActive:a,isDisabled:i}),{getMenuItemProps:f,focusMenuItem:P}=O(),d=useRef(null);useEffect(()=>{l&&d.current&&P(d.current);},[l,P]);let h=s!=null?s:mt;return F.createElement(h,C(u(u({role:"menuitem"},M),f(M)),{className:cx(y.root,n),"data-test-id":S,ref:mergeRefs(d,t),tabIndex:-1}),e.children)}Ee.displayName="MenuItem";var H=F.forwardRef(Ee);var N=e=>{let t=F.Children.only(e.children),{getTriggerProps:o}=O();return F.createElement(Popover.Trigger,null,F.cloneElement(t,C(u({},o(t.props,t.ref)),{["aria-haspopup"]:"menu"})))};var Le=()=>css({border:"none",width:"100%",height:"1px",backgroundColor:T.gray200,margin:`${T.spacing2Xs} 0`});var V=e=>{let i=e,{children:t,testId:o="cf-ui-menu-divider",className:n}=i,s=b(i,["children","testId","className"]),a=Le();return F.createElement("hr",u({"aria-orientation":"horizontal","data-test-id":o,className:cx(a,n)},s))};var Re=()=>css({color:T.gray500,textAlign:"left",padding:`${T.spacingXs} ${T.spacingS} ${T.spacing2Xs}`,lineHeight:T.lineHeightM});var J=e=>{let i=e,{children:t,testId:o="cf-ui-menu-section-title",className:n}=i,s=b(i,["children","testId","className"]),a=Re();return F.createElement(Caption,u({"aria-hidden":"true",as:"div",testId:o,className:cx(a,n),marginBottom:"none"},s),t)};var Tt=[-8,2],Z=e=>{let h=e,{onClose:t,onOpen:o}=h,n=b(h,["onClose","onOpen"]),{isOpen:s,menuId:a,propsToPropagateToSubmenus:i}=O(),l=useRef(null),M=useRef(null),[c,S]=useState(!1),y=useCallback(()=>{S(!0),window.clearTimeout(M.current),o==null||o();},[o]),f=useCallback(()=>{S(!1),window.clearTimeout(M.current),t==null||t();},[t]),P=useCallback(()=>{var m;f(),(m=l.current)==null||m.focus({preventScroll:!0});},[f]);useEffect(()=>{s===!1&&S(!1);},[s]);let d=useMemo(()=>({isOpen:c,getSubmenuListProps:m=>({"data-parent-menu":a,onMouseOver:R=>{var p;y(),(p=m.onMouseOver)==null||p.call(m,R);},onMouseLeave:R=>{var p;P(),(p=m.onMouseLeave)==null||p.call(m,R);}}),getSubmenuTriggerProps:(m,R)=>({ref:mergeRefs(l,R),onKeyDown:p=>{var I;p.key==="ArrowRight"&&(p.preventDefault(),y()),(I=m.onKeyDown)==null||I.call(m,p);},onMouseOver:p=>{var I;y(),(I=m.onMouseOver)==null||I.call(m,p);},onMouseLeave:p=>{var I;M.current=window.setTimeout(P,300),(I=m.onMouseLeave)==null||I.call(m,p);}})}),[c,a,y,P]);return F.createElement(xe,{value:d},F.createElement(B,C(u(u({},i),n),{isOpen:c,onClose:f,onOpen:y,placement:"right-start",offset:Tt,isAutoalignmentEnabled:!1})))};var ke=()=>({root:({isActive:e})=>css(u({display:"flex",alignItems:"center",paddingRight:T.spacingXs},e?{backgroundColor:T.gray100}:{})),content:css({marginRight:T.spacingM}),icon:css({marginLeft:"auto",fill:"currentColor"})});var Ct=(e,t)=>{let{className:o,children:n}=e,{getSubmenuTriggerProps:s,isOpen:a}=U(),i=ke();return F.createElement(N,null,F.createElement(H,C(u(u({},e),s(e,t)),{className:cx(i.root({isActive:a}),o)}),F.createElement("span",{className:i.content},n),F.createElement(ChevronRightIcon,{className:i.icon})))},te=F.forwardRef(Ct);var L=B;L.List=q;L.ListHeader=k;L.ListFooter=D;L.Item=H;L.Trigger=N;L.Divider=V;L.SectionTitle=J;L.Submenu=Z;L.SubmenuTrigger=te;

export { L as Menu, V as MenuDivider, H as MenuItem, q as MenuList, J as MenuSectionTitle, N as MenuTrigger, Z as Submenu, te as SubmenuTrigger };
//# sourceMappingURL=index.js.map