{"ast":null,"code":"import _slicedToArray from\"/Users/gracielaalaniz/Documents/cloudflare-build/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState}from'react';import{Button,Text}from'@contentful/f36-components';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Sidebar=function Sidebar(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),disabled=_useState2[0],setDisabled=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),message=_useState6[0],setMessage=_useState6[1];var setResult=function setResult(){var type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:\"build\";var message=\"There was a problem building the site. Try again later.\";if(type===\"build\"){message=\"Site build triggered.\";}if(type===\"done\"){message=\"Site successfully built!\";}setLoading(type===\"build\");setDisabled(type===\"build\");setMessage(message);};var clickHandler=function clickHandler(){/* Update button */setLoading(true);setDisabled(true);var accountId=\"1c96388f497c618fe44176227e8be52f\";var projectName=\"olivia-korosak\";var email=\"graciela@alanizcreative.com\";var branch=\"staging\";var apiKey=\"26c9a612df9d83fcf7fc9371d57f4d904c4d0\";var form=new FormData();form.append(\"branch\",branch);var options={method:\"POST\",headers:{\"Content-Type\":\"multipart/form-data; boundary=---011000010111000001101001\",\"X-Auth-Email\":email,\"X-Auth-Key\":apiKey}};options.body=form;console.log(\"FORM\",options,\"https://contentful-deploy.alanizcreative.workers.dev/client/v4/accounts/\".concat(accountId,\"/pages/projects/\").concat(projectName,\"/deployments\"));/* Request */fetch(\"https://contentful-deploy.alanizcreative.workers.dev/client/v4/accounts/\".concat(accountId,\"/pages/projects/\").concat(projectName,\"/deployments\"),options).then(function(res){return res.json();}).then(function(res){if(res.success){setResult(\"build\");var deploymentId=res.result.id.replace(/-/g,\"\");console.log(\"OUTER\",deploymentId,res);var polling=setInterval(function(){fetch(\"https://contentful-deploy.alanizcreative.workers.dev/client/v4/accounts/\".concat(accountId,\"/pages/projects/\").concat(projectName,\"/deployments/\").concat(deploymentId),{method:\"GET\",headers:{\"Content-Type\":\"application/json\",\"X-Auth-Email\":email,\"X-Auth-Key\":apiKey}}).then(function(r){return r.json();}).then(function(r){console.log(\"INNER\",r);if(r.result.latest_stage.name===\"deploy\"){// clearInterval(polling);\n// setResult(\"done\");\n}}).catch(function(){clearInterval(polling);setResult(\"error\");});},30000);}else{setResult(\"error\");}}).catch(function(){setResult(\"error\");});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{variant:\"primary\",isFullWidth:true,isDisabled:disabled,isLoading:loading,onClick:clickHandler,children:\"Build Site\"}),/*#__PURE__*/_jsx(\"div\",{\"aria-live\":\"polite\",children:/*#__PURE__*/_jsx(Text,{fontColor:\"gray600\",marginTop:\"spacingM\",as:\"p\",children:message})})]});};export default Sidebar;","map":{"version":3,"names":["React","useState","Button","Text","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","Sidebar","_useState","_useState2","_slicedToArray","disabled","setDisabled","_useState3","_useState4","loading","setLoading","_useState5","_useState6","message","setMessage","setResult","type","arguments","length","undefined","clickHandler","accountId","projectName","email","branch","apiKey","form","FormData","append","options","method","headers","body","console","log","concat","fetch","then","res","json","success","deploymentId","result","id","replace","polling","setInterval","r","latest_stage","name","catch","clearInterval","children","variant","isFullWidth","isDisabled","isLoading","onClick","fontColor","marginTop","as"],"sources":["/Users/gracielaalaniz/Documents/cloudflare-build/src/locations/Sidebar.jsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { Button, Text } from '@contentful/f36-components';\n\nconst Sidebar = () => {\n  const [disabled, setDisabled] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [message, setMessage] = useState(\"\");\n\n  const setResult = (type = \"build\") => {\n    let message = \"There was a problem building the site. Try again later.\";\n\n    if (type === \"build\") {\n      message = \"Site build triggered.\";\n    }\n\n    if (type === \"done\") {\n      message = \"Site successfully built!\";\n    }\n\n    setLoading(type === \"build\");\n    setDisabled(type === \"build\");\n    setMessage(message);\n  };\n\n  const clickHandler = () => {\n    /* Update button */\n\n    setLoading(true);\n    setDisabled(true);\n\n    const accountId = \"1c96388f497c618fe44176227e8be52f\";\n    const projectName = \"olivia-korosak\";\n    const email = \"graciela@alanizcreative.com\";\n    const branch = \"staging\";\n    const apiKey = \"26c9a612df9d83fcf7fc9371d57f4d904c4d0\";\n\n    const form = new FormData();\n    form.append(\"branch\", branch);\n\n    const options = {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"multipart/form-data; boundary=---011000010111000001101001\",\n        \"X-Auth-Email\": email,\n        \"X-Auth-Key\": apiKey\n      }\n    };\n\n    options.body = form;\n\n    console.log(\"FORM\", options, `https://contentful-deploy.alanizcreative.workers.dev/client/v4/accounts/${accountId}/pages/projects/${projectName}/deployments`);\n\n    /* Request */\n\n    fetch(\n      `https://contentful-deploy.alanizcreative.workers.dev/client/v4/accounts/${accountId}/pages/projects/${projectName}/deployments`, options\n    )\n    .then(res => res.json())\n    .then(res => {\n      if (res.success) {\n        setResult(\"build\");\n\n        const deploymentId = res.result.id.replace(/-/g, \"\");\n\n        console.log(\"OUTER\", deploymentId, res);\n\n        const polling = setInterval(() => {\n          fetch(\n            `https://contentful-deploy.alanizcreative.workers.dev/client/v4/accounts/${accountId}/pages/projects/${projectName}/deployments/${deploymentId}`,\n            {\n              method: \"GET\",\n              headers: {\n                \"Content-Type\": \"application/json\",\n                \"X-Auth-Email\": email,\n                \"X-Auth-Key\": apiKey\n              }\n            }\n          )\n          .then(r => r.json())\n          .then(r => {\n            console.log(\"INNER\", r);\n\n            if (r.result.latest_stage.name === \"deploy\") {\n              // clearInterval(polling);\n              // setResult(\"done\");\n            }\n          })\n          .catch(() => {\n            clearInterval(polling);\n            setResult(\"error\");\n          });\n        }, 30000);\n      } else {\n        setResult(\"error\");\n      }\n    })\n    .catch(() => {\n      setResult(\"error\");\n    });\n  };\n\n  return (\n    <>\n      <Button\n        variant=\"primary\"\n        isFullWidth\n        isDisabled={disabled}\n        isLoading={loading}\n        onClick={clickHandler}\n      >\n        Build Site\n      </Button>\n      <div aria-live=\"polite\">\n        <Text\n          fontColor=\"gray600\"\n          marginTop=\"spacingM\"\n          as=\"p\"\n        >\n          {message}\n        </Text>\n      </div>\n    </>\n  );\n};\n\nexport default Sidebar;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}